name: ðŸ§  Ð£Ð¼Ð½Ñ‹Ð¹ Ð¿Ð°Ð¹Ð¿Ð»Ð°Ð½ Task Manager

on:
  push:
    branches: [main, develop]
    paths-ignore:
      - 'README.md'
      - 'docs/**'
      - '**.md'
  pull_request:
    branches: [main]
  workflow_dispatch:  # Ð ÑƒÑ‡Ð½Ð¾Ð¹ Ð·Ð°Ð¿ÑƒÑÐº
    inputs:
      environment:
        description: 'ÐžÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ðµ Ð´Ð»Ñ Ð´ÐµÐ¿Ð»Ð¾Ñ'
        required: false
        default: 'staging'
        type: choice
        options:
        - staging
        - production

env:
  DOTNET_VERSION: '8.0.x'
  PROJECT_NAME: 'SmartTaskManager'

defaults:
  run:
    working-directory: ./src/${{ env.PROJECT_NAME }}

jobs:
  # 1. ÐŸÐ¾Ð´Ð³Ð¾Ñ‚Ð¾Ð²ÐºÐ° Ð¸ Ð°Ð½Ð°Ð»Ð¸Ð·
  setup-and-analyze:
    name: âš¡ ÐŸÐ¾Ð´Ð³Ð¾Ñ‚Ð¾Ð²ÐºÐ° Ð¸ Ð°Ð½Ð°Ð»Ð¸Ð·
    runs-on: ubuntu-latest

    outputs:
      has_project: ${{ steps.check-project.outputs.has_project }}
      has_tests: ${{ steps.check-project.outputs.has_tests }}
      changes_summary: ${{ steps.check-changes.outputs.summary }}

    steps:
    - name: ðŸ“¥ Ð—Ð°Ð³Ñ€ÑƒÐ¶Ð°ÐµÐ¼ ÐºÐ¾Ð´
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: ðŸ” ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð½Ð°Ð»Ð¸Ñ‡Ð¸Ðµ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°
      id: check-project
      run: |
        echo "ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñ‹ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°..."
        
        # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð¾ÑÐ½Ð¾Ð²Ð½Ð¾Ð¹ Ð¿Ñ€Ð¾ÐµÐºÑ‚
        if [ -f "src/${{ env.PROJECT_NAME }}/${{ env.PROJECT_NAME }}.csproj" ]; then
          echo "âœ… ÐžÑÐ½Ð¾Ð²Ð½Ð¾Ð¹ Ð¿Ñ€Ð¾ÐµÐºÑ‚ Ð½Ð°Ð¹Ð´ÐµÐ½"
          echo "has_project=true" >> $GITHUB_OUTPUT
        else
          echo "âŒ ÐžÑÐ½Ð¾Ð²Ð½Ð¾Ð¹ Ð¿Ñ€Ð¾ÐµÐºÑ‚ ÐÐ• Ð½Ð°Ð¹Ð´ÐµÐ½"
          echo "Ð˜Ñ‰ÐµÐ¼ Ñ„Ð°Ð¹Ð»Ñ‹ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°..."
          find . -name "*.csproj" -type f
          echo "has_project=false" >> $GITHUB_OUTPUT
        fi
        
        # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ñ‚ÐµÑÑ‚Ñ‹
        if [ -f "tests/${{ env.PROJECT_NAME }}.Tests/${{ env.PROJECT_NAME }}.Tests.csproj" ]; then
          echo "âœ… Ð¢ÐµÑÑ‚Ð¾Ð²Ñ‹Ð¹ Ð¿Ñ€Ð¾ÐµÐºÑ‚ Ð½Ð°Ð¹Ð´ÐµÐ½"
          echo "has_tests=true" >> $GITHUB_OUTPUT
        else
          echo "âš ï¸ Ð¢ÐµÑÑ‚Ð¾Ð²Ñ‹Ð¹ Ð¿Ñ€Ð¾ÐµÐºÑ‚ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½"
          echo "has_tests=false" >> $GITHUB_OUTPUT
        fi

    - name: ðŸ” ÐÐ½Ð°Ð»Ð¸Ð·Ð¸Ñ€ÑƒÐµÐ¼ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ
      id: check-changes
      run: |
        echo "ÐÐ½Ð°Ð»Ð¸Ð· Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹ Ð² ÐºÐ¾Ð¼Ð¼Ð¸Ñ‚Ð°Ñ…..."
        
        # ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ð´Ð»Ñ PR Ð¸Ð»Ð¸ push
        if [ "${{ github.event_name }}" = "pull_request" ]; then
          BASE_REF="${{ github.event.pull_request.base.ref }}"
          HEAD_REF="${{ github.event.pull_request.head.ref }}"
          echo "Ð¡Ñ€Ð°Ð²Ð½Ð¸Ð²Ð°ÐµÐ¼ $BASE_REF...$HEAD_REF"
        else
          echo "ÐÐ½Ð°Ð»Ð¸Ð· Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ñ… Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹..."
        fi
        
        # ÐŸÑ€Ð¾ÑÑ‚Ð¾Ð¹ Ð°Ð½Ð°Ð»Ð¸Ð· Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð½Ñ‹Ñ… Ñ„Ð°Ð¹Ð»Ð¾Ð²
        CHANGED_FILES=$(git diff --name-only HEAD~1 HEAD 2>/dev/null || echo "")
        if [ -n "$CHANGED_FILES" ]; then
          echo "Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð½Ñ‹Ðµ Ñ„Ð°Ð¹Ð»Ñ‹:"
          echo "$CHANGED_FILES"
          echo "summary=Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ð¾Ð±Ð½Ð°Ñ€ÑƒÐ¶ÐµÐ½Ñ‹" >> $GITHUB_OUTPUT
        else
          echo "summary=ÐÐµÑ‚ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹" >> $GITHUB_OUTPUT
        fi

    - name: âš™ï¸ Ð£ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ .NET
      uses: actions/setup-dotnet@v3
      with:
        dotnet-version: ${{ env.DOTNET_VERSION }}

    - name: ðŸ’¾ ÐšÑÑˆÐ¸Ñ€ÑƒÐµÐ¼ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸
      uses: actions/cache@v3
      with:
        path: |
          ~/.nuget/packages
          ~/.local/share/NuGet
          **/packages.lock.json
        key: ${{ runner.os }}-nuget-${{ hashFiles('**/*.csproj') }}

  # 2. Ð’Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹
  restore:
    name: ðŸ“¦ Ð’Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹
    needs: setup-and-analyze
    runs-on: ubuntu-latest
    if: needs.setup-and-analyze.outputs.has_project == 'true'

    steps:
    - name: ðŸ“¥ Ð—Ð°Ð³Ñ€ÑƒÐ¶Ð°ÐµÐ¼ ÐºÐ¾Ð´
      uses: actions/checkout@v4

    - name: âš™ï¸ Ð£ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ .NET
      uses: actions/setup-dotnet@v3
      with:
        dotnet-version: ${{ env.DOTNET_VERSION }}

    - name: ðŸ“¦ Ð’Ð¾ÑÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ Ð¾ÑÐ½Ð¾Ð²Ð½Ð¾Ð¹ Ð¿Ñ€Ð¾ÐµÐºÑ‚
      run: |
        echo "Ð’Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¾ÑÐ½Ð¾Ð²Ð½Ð¾Ð³Ð¾ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°..."
        dotnet restore "src/${{ env.PROJECT_NAME }}/${{ env.PROJECT_NAME }}.csproj"
        echo "âœ… Ð—Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ Ð²Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ñ‹"

    - name: ðŸ“¦ Ð’Ð¾ÑÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ Ñ‚ÐµÑÑ‚Ñ‹
      if: needs.setup-and-analyze.outputs.has_tests == 'true'
      run: |
        echo "Ð’Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ñ‚ÐµÑÑ‚Ð¾Ð²Ð¾Ð³Ð¾ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°..."
        dotnet restore "tests/${{ env.PROJECT_NAME }}.Tests/${{ env.PROJECT_NAME }}.Tests.csproj"
        echo "âœ… Ð¢ÐµÑÑ‚Ð¾Ð²Ñ‹Ðµ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ Ð²Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ñ‹"

  # 3. Ð¡Ð±Ð¾Ñ€ÐºÐ°
  build:
    name: ðŸ”¨ Ð¡Ð±Ð¾Ñ€ÐºÐ°
    needs: restore
    runs-on: ubuntu-latest

    strategy:
      matrix:
        configuration: [Debug, Release]

    steps:
    - name: ðŸ“¥ Ð—Ð°Ð³Ñ€ÑƒÐ¶Ð°ÐµÐ¼ ÐºÐ¾Ð´
      uses: actions/checkout@v4

    - name: âš™ï¸ Ð£ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ .NET
      uses: actions/setup-dotnet@v3
      with:
        dotnet-version: ${{ env.DOTNET_VERSION }}

    - name: ðŸ”¨ Ð¡Ð¾Ð±Ð¸Ñ€Ð°ÐµÐ¼ Ð¿Ñ€Ð¾ÐµÐºÑ‚
      run: |
        echo "Ð¡Ð±Ð¾Ñ€ÐºÐ° Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð° Ð² ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸: ${{ matrix.configuration }}"
        dotnet build "src/${{ env.PROJECT_NAME }}/${{ env.PROJECT_NAME }}.csproj" \
          --configuration ${{ matrix.configuration }} \
          --no-restore
        
        echo "âœ… Ð¡Ð±Ð¾Ñ€ÐºÐ° Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð°"
        
        # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚
        if [ -d "src/${{ env.PROJECT_NAME }}/bin/${{ matrix.configuration }}/net8.0" ]; then
          echo "ðŸ“ Ð¡Ð¾Ð±Ñ€Ð°Ð½Ð½Ñ‹Ðµ Ñ„Ð°Ð¹Ð»Ñ‹:"
          ls -la "src/${{ env.PROJECT_NAME }}/bin/${{ matrix.configuration }}/net8.0/"
        fi

    - name: ðŸ’¾ Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð°Ñ€Ñ‚ÐµÑ„Ð°ÐºÑ‚ ÑÐ±Ð¾Ñ€ÐºÐ¸
      if: matrix.configuration == 'Release'
      uses: actions/upload-artifact@v4
      with:
        name: build-output
        path: src/${{ env.PROJECT_NAME }}/bin/Release/net8.0/
        retention-days: 7

  # 4. Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ
  test:
    name: ðŸ§ª Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ
    needs: restore
    runs-on: ubuntu-latest
    if: needs.setup-and-analyze.outputs.has_tests == 'true'

    steps:
    - name: ðŸ“¥ Ð—Ð°Ð³Ñ€ÑƒÐ¶Ð°ÐµÐ¼ ÐºÐ¾Ð´
      uses: actions/checkout@v4

    - name: âš™ï¸ Ð£ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ .NET
      uses: actions/setup-dotnet@v3
      with:
        dotnet-version: ${{ env.DOTNET_VERSION }}

    - name: ðŸ§ª Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ unit-Ñ‚ÐµÑÑ‚Ñ‹
      run: |
        echo "Ð—Ð°Ð¿ÑƒÑÐº unit-Ñ‚ÐµÑÑ‚Ð¾Ð²..."
        dotnet test "tests/${{ env.PROJECT_NAME }}.Tests/${{ env.PROJECT_NAME }}.Tests.csproj" \
          --filter "Category=Unit" \
          --verbosity normal \
          --logger "trx" \
          --results-directory TestResults \
          --no-restore
        
        echo "âœ… Unit-Ñ‚ÐµÑÑ‚Ñ‹ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ñ‹"

    - name: ðŸ§ª Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ Ð¸Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ð¾Ð½Ð½Ñ‹Ðµ Ñ‚ÐµÑÑ‚Ñ‹
      if: github.ref == 'refs/heads/main'
      run: |
        echo "Ð—Ð°Ð¿ÑƒÑÐº Ð¸Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ð¾Ð½Ð½Ñ‹Ñ… Ñ‚ÐµÑÑ‚Ð¾Ð²..."
        dotnet test "tests/${{ env.PROJECT_NAME }}.Tests/${{ env.PROJECT_NAME }}.Tests.csproj" \
          --filter "Category=Integration" \
          --verbosity normal \
          --logger "trx" \
          --results-directory TestResults \
          --no-restore
        
        echo "âœ… Ð˜Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ð¾Ð½Ð½Ñ‹Ðµ Ñ‚ÐµÑÑ‚Ñ‹ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ñ‹"

    - name: ðŸ“Š Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ Ñ‚ÐµÑÑ‚Ð¾Ð²
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: test-results
        path: TestResults/
        retention-days: 30

  # 5. Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð¿Ð°ÐºÐµÑ‚Ð°
  package:
    name: ðŸ“¦ Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð¿Ð°ÐºÐµÑ‚Ð°
    needs: [build, test]
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main' || github.event_name == 'workflow_dispatch'

    steps:
    - name: ðŸ“¥ Ð—Ð°Ð³Ñ€ÑƒÐ¶Ð°ÐµÐ¼ ÐºÐ¾Ð´
      uses: actions/checkout@v4

    - name: âš™ï¸ Ð£ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ .NET
      uses: actions/setup-dotnet@v3
      with:
        dotnet-version: ${{ env.DOTNET_VERSION }}

    - name: ðŸ“¦ Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ NuGet Ð¿Ð°ÐºÐµÑ‚
      run: |
        echo "Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ NuGet Ð¿Ð°ÐºÐµÑ‚Ð°..."
        mkdir -p packages
        
        dotnet pack "src/${{ env.PROJECT_NAME }}/${{ env.PROJECT_NAME }}.csproj" \
          --configuration Release \
          --output ./packages \
          --no-restore \
          --verbosity normal
        
        echo "âœ… ÐŸÐ°ÐºÐµÑ‚ ÑÐ¾Ð·Ð´Ð°Ð½"
        echo "ðŸ“¦ Ð¡Ð¾Ð·Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¿Ð°ÐºÐµÑ‚Ñ‹:"
        ls -la packages/*.nupkg

    - name: ðŸš€ ÐŸÑƒÐ±Ð»Ð¸ÐºÑƒÐµÐ¼ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ
      run: |
        echo "ÐŸÑƒÐ±Ð»Ð¸ÐºÐ°Ñ†Ð¸Ñ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ..."
        mkdir -p publish
        
        dotnet publish "src/${{ env.PROJECT_NAME }}/${{ env.PROJECT_NAME }}.csproj" \
          -c Release \
          -o ./publish \
          --self-contained false \
          --no-restore
        
        echo "âœ… ÐŸÑƒÐ±Ð»Ð¸ÐºÐ°Ñ†Ð¸Ñ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð°"
        
        # Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð²ÐµÑ€ÑÐ¸ÑŽ Ð½Ð° Ð¾ÑÐ½Ð¾Ð²Ðµ Ð´Ð°Ñ‚Ñ‹ Ð¸ ÐºÐ¾Ð¼Ð¼Ð¸Ñ‚Ð°
        SHORT_SHA=${GITHUB_SHA:0:7}
        BUILD_DATE=$(date +%Y%m%d_%H%M%S)
        VERSION="1.0.$BUILD_DATE-$SHORT_SHA"
        
        echo "VERSION=$VERSION" >> $GITHUB_ENV
        echo "ðŸ”– Ð’ÐµÑ€ÑÐ¸Ñ ÑÐ±Ð¾Ñ€ÐºÐ¸: $VERSION"

    - name: ðŸ’¾ Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð¿Ð°ÐºÐµÑ‚Ñ‹
      uses: actions/upload-artifact@v4
      with:
        name: deployment-packages
        path: |
          packages/
          publish/
        retention-days: 30

  # 6. ÐžÑ‚Ñ‡ÐµÑ‚ Ð¾ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ð¸
  report:
    name: ðŸ“Š ÐžÑ‚Ñ‡ÐµÑ‚ Ð¾ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ð¸
    needs: [setup-and-analyze, build, test, package]
    runs-on: ubuntu-latest
    if: always()

    steps:
    - name: ðŸ“ Ð“ÐµÐ½ÐµÑ€Ð¸Ñ€ÑƒÐµÐ¼ Ð¾Ñ‚Ñ‡ÐµÑ‚
      run: |
        echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
        echo "â•‘               ðŸ§  SMART TASK MANAGER CI/CD                â•‘"
        echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
        echo "â•‘                                                          â•‘"
        echo "â•‘  ðŸ“‹ Ð˜ÐÐ¤ÐžÐ ÐœÐÐ¦Ð˜Ð¯ Ðž Ð¡Ð‘ÐžÐ ÐšÐ•:                                â•‘"
        echo "â•‘    â€¢ Ð’ÐµÑ‚ÐºÐ°:       ${{ github.ref }}"
        echo "â•‘    â€¢ ÐšÐ¾Ð¼Ð¼Ð¸Ñ‚:      ${{ github.sha }}"
        echo "â•‘    â€¢ Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ñ‚Ð¾Ñ€:   ${{ github.actor }}"
        echo "â•‘    â€¢ Ð¡Ð¾Ð±Ñ‹Ñ‚Ð¸Ðµ:     ${{ github.event_name }}"
        echo "â•‘                                                          â•‘"
        echo "â•‘  ðŸ“Š Ð Ð•Ð—Ð£Ð›Ð¬Ð¢ÐÐ¢Ð« Ð’Ð«ÐŸÐžÐ›ÐÐ•ÐÐ˜Ð¯:                              â•‘"
        echo "â•‘    âš¡ ÐŸÐ¾Ð´Ð³Ð¾Ñ‚Ð¾Ð²ÐºÐ°:  ${{ needs.setup-and-analyze.result }}"
        echo "â•‘    ðŸ“¦ Ð’Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð².:  ${{ needs.restore.result || 'skipped' }}"
        echo "â•‘    ðŸ”¨ Ð¡Ð±Ð¾Ñ€ÐºÐ°:      ${{ needs.build.result || 'skipped' }}"
        echo "â•‘    ðŸ§ª Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ: ${{ needs.test.result || 'skipped' }}"
        echo "â•‘    ðŸ“¦ ÐŸÐ°ÐºÐµÑ‚:       ${{ needs.package.result || 'skipped' }}"
        echo "â•‘                                                          â•‘"
        
        # ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»ÑÐµÐ¼ ÑÑ‚Ð°Ñ‚ÑƒÑ ÑÐ±Ð¾Ñ€ÐºÐ¸
        if [ "${{ job.status }}" == "success" ]; then
          echo "â•‘  ðŸŽ‰ Ð¡Ð¢ÐÐ¢Ð£Ð¡: Ð’Ð¡Ð• Ð­Ð¢ÐÐŸÐ« Ð’Ð«ÐŸÐžÐ›ÐÐ•ÐÐ« Ð£Ð¡ÐŸÐ•Ð¨ÐÐž               â•‘"
        elif [ "${{ job.status }}" == "failure" ]; then
          echo "â•‘  âŒ Ð¡Ð¢ÐÐ¢Ð£Ð¡: ÐžÐ‘ÐÐÐ Ð£Ð–Ð•ÐÐ« ÐžÐ¨Ð˜Ð‘ÐšÐ˜                         â•‘"
        elif [ "${{ job.status }}" == "cancelled" ]; then
          echo "â•‘  âš ï¸ Ð¡Ð¢ÐÐ¢Ð£Ð¡: Ð’Ð«ÐŸÐžÐ›ÐÐ•ÐÐ˜Ð• ÐžÐ¢ÐœÐ•ÐÐ•ÐÐž                      â•‘"
        else
          echo "â•‘  ðŸ”„ Ð¡Ð¢ÐÐ¢Ð£Ð¡: Ð’Ð«ÐŸÐžÐ›ÐÐ•ÐÐ˜Ð• ÐŸÐ Ð•Ð Ð’ÐÐÐž                      â•‘"
        fi
        
        echo "â•‘                                                          â•‘"
        echo "â•‘  ðŸ• Ð’Ñ€ÐµÐ¼Ñ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ñ: $(date '+%Y-%m-%d %H:%M:%S %Z')    â•‘"
        echo "â•‘                                                          â•‘"
        echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        
        # Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð¿Ñ€Ð¾ÑÑ‚Ð¾Ð¹ Ñ„Ð°Ð¹Ð» Ð¾Ñ‚Ñ‡ÐµÑ‚Ð°
        cat > report.md << EOF
        # ÐžÑ‚Ñ‡ÐµÑ‚ Ð¾ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ð¸ CI/CD
        
        ## ÐžÑÐ½Ð¾Ð²Ð½Ð°Ñ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ
        - **ÐŸÑ€Ð¾ÐµÐºÑ‚:** ${{ env.PROJECT_NAME }}
        - **Ð’ÐµÑ‚ÐºÐ°:** ${{ github.ref }}
        - **ÐšÐ¾Ð¼Ð¼Ð¸Ñ‚:** ${{ github.sha }}
        - **Ð”Ð°Ñ‚Ð°:** $(date)
        
        ## Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ ÑÑ‚Ð°Ð¿Ð¾Ð²
        1. âš¡ ÐŸÐ¾Ð´Ð³Ð¾Ñ‚Ð¾Ð²ÐºÐ° Ð¸ Ð°Ð½Ð°Ð»Ð¸Ð·: ${{ needs.setup-and-analyze.result }}
        2. ðŸ“¦ Ð’Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹: ${{ needs.restore.result || 'skipped' }}
        3. ðŸ”¨ Ð¡Ð±Ð¾Ñ€ÐºÐ°: ${{ needs.build.result || 'skipped' }}
        4. ðŸ§ª Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ: ${{ needs.test.result || 'skipped' }}
        5. ðŸ“¦ Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð¿Ð°ÐºÐµÑ‚Ð°: ${{ needs.package.result || 'skipped' }}
        
        ## Ð¡Ñ‚Ð°Ñ‚ÑƒÑ
        $(if [ "${{ job.status }}" == "success" ]; then echo "âœ… Ð’ÑÐµ ÑÑ‚Ð°Ð¿Ñ‹ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ñ‹ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾"; elif [ "${{ job.status }}" == "failure" ]; then echo "âŒ ÐžÐ±Ð½Ð°Ñ€ÑƒÐ¶ÐµÐ½Ñ‹ Ð¾ÑˆÐ¸Ð±ÐºÐ¸"; else echo "âš ï¸ Ð§Ð°ÑÑ‚Ð¸Ñ‡Ð½Ð¾Ðµ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ"; fi)
        EOF

    - name: ðŸ”” Ð£Ð²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ðµ Ð¾ ÑÑ‚Ð°Ñ‚ÑƒÑÐµ
      if: always()
      run: |
        if [ "${{ job.status }}" == "success" ]; then
          echo "âœ… CI/CD Ð¿Ð°Ð¹Ð¿Ð»Ð°Ð¹Ð½ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾!"
          echo "ðŸ“¦ ÐÑ€Ñ‚ÐµÑ„Ð°ÐºÑ‚Ñ‹ ÑÐ±Ð¾Ñ€ÐºÐ¸ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹ Ð´Ð»Ñ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸"
          echo "ðŸ”– Ð’ÐµÑ€ÑÐ¸Ñ: ${{ env.VERSION || 'Ð½Ðµ ÑƒÐºÐ°Ð·Ð°Ð½Ð°' }}"
        elif [ "${{ needs.test.result }}" == "failure" ]; then
          echo "âŒ Ð¢Ð•Ð¡Ð¢Ð« ÐÐ• ÐŸÐ ÐžÐ¨Ð›Ð˜!"
          echo "Ð¢Ñ€ÐµÐ±ÑƒÐµÑ‚ÑÑ Ð²Ð½Ð¸Ð¼Ð°Ð½Ð¸Ðµ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ°"
        elif [ "${{ needs.build.result }}" == "failure" ]; then
          echo "âŒ ÐžÐ¨Ð˜Ð‘ÐšÐ Ð¡Ð‘ÐžÐ ÐšÐ˜!"
          echo "ÐŸÑ€Ð¾ÐµÐºÑ‚ Ð½Ðµ ÐºÐ¾Ð¼Ð¿Ð¸Ð»Ð¸Ñ€ÑƒÐµÑ‚ÑÑ"
        else
          echo "âš ï¸ Ð§Ð°ÑÑ‚Ð¸Ñ‡Ð½Ð¾Ðµ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ Ð¸Ð»Ð¸ Ð¿Ñ€Ð¾Ð¿ÑƒÑÐº ÑÑ‚Ð°Ð¿Ð¾Ð²"
        fi

    - name: ðŸ’¾ Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð¾Ñ‚Ñ‡ÐµÑ‚
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: execution-report
        path: report.md
        retention-days: 90